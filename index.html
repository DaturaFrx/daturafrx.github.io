<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Appwrite Automatic Setup</title>
  <!-- Appwrite SDK -->
  <script src="https://cdn.jsdelivr.net/npm/appwrite@16.1.0"></script>
  <!-- Small Dark CSS -->
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }
    h1 {
      color: #bb86fc;
    }
    p {
      color: #e0e0e0;
    }
    button {
      background-color: #bb86fc;
      color: #121212;
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 20px;
      border-radius: 4px;
    }
    button:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Appwrite Automatic Setup</h1>
    <p>Check the console for output details.</p>
    <button onclick="setupDatabase()">Setup Database</button>
  </div>

  <script>
    // Initialize Appwrite client
    const client = new Appwrite.Client()
      .setEndpoint('https://cloud.appwrite.io/v1') // Appwrite Cloud endpoint
      .setProject('67afcea40030753236db'); // Your Appwrite project ID

    const databases = new Appwrite.Databases(client);

    // Define your desired IDs
    const databaseId = 'generalDB';       // Adjust if needed
    const collectionId = 'textCollection';  // Adjust if needed

    async function setupDatabase() {
      // Check if the database exists, or create it
      try {
        const dbList = await databases.list();
        const dbExists = dbList.databases.some(db => db.$id === databaseId);
        if (!dbExists) {
          console.log("Database not found. Creating...");
          await databases.create(databaseId, 'General Database');
        } else {
          console.log("Database already exists.");
        }
      } catch (error) {
        console.error("Error checking/creating database:", error);
        return;
      }

      // Check if the collection exists, or create it with a "text" attribute
      try {
        const collections = await databases.listCollections(databaseId);
        const collectionExists = collections.collections.some(col => col.$id === collectionId);
        if (!collectionExists) {
          console.log("Collection not found. Creating...");
          await databases.createCollection(
            databaseId,
            collectionId,
            'Text Collection',
            ['role:all'] // Permissions: adjust as needed
          );
          // Add a 'text' field (string type, max length 255, required)
          await databases.createStringAttribute(databaseId, collectionId, 'text', 255, true);
        } else {
          console.log("Collection already exists.");
        }
      } catch (error) {
        console.error("Error checking/creating collection:", error);
        return;
      }

      // Create a document with a sample text field
      try {
        const response = await databases.createDocument(
          databaseId,
          collectionId,
          'unique()', // Let Appwrite generate a unique document ID
          {
            text: "Hello from Appwrite!"
          }
        );
        console.log("Document Created Successfully:", response);
      } catch (error) {
        console.error("Error creating document:", error);
      }
    }
  </script>
</body>
</html>
