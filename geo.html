<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Geohash — Map & Locator</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<style>
:root{--bg:#0b0c0d;--card:#0f1112;--muted:#9aa0a6;--accent:#6ee7b7;--mono:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace}
*{box-sizing:border-box}
html,body,#map{height:100%}
body{margin:0;background:var(--bg);color:#e6eef3;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.app{display:flex;flex-direction:column;height:100vh}
.header{padding:12px;display:flex;gap:8px;align-items:center;justify-content:space-between}
.title{font-weight:700}
.controls{display:flex;gap:8px;align-items:center}
.btn{appearance:none;border:0;padding:8px 10px;border-radius:10px;background:#173c35;color:#e6f7ef;font-weight:700}
.card{background:var(--card);margin:10px;border-radius:12px;padding:10px;box-shadow:0 8px 24px rgba(0,0,0,0.6)}
.row{display:flex;gap:8px;align-items:center}
.input{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.small{font-size:13px;color:var(--muted)}
.footer{padding:8px;text-align:center;font-size:12px;color:var(--muted)}
#map{flex:1;border-top-left-radius:12px;border-top-right-radius:12px;margin:10px;overflow:hidden}
.info{font-family:var(--mono);font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
@media (max-width:420px){.header{padding:8px}.card{margin:8px}}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div>
      <div class="title">Geohash Map</div>
      <div class="small">Find current location, paste geohash, click map to get geohash</div>
    </div>
    <div class="controls">
      <button id="locBtn" class="btn">Find me</button>
      <button id="copyBtn" class="btn">Copy GH</button>
    </div>
  </div>  <div class="card">
    <div class="row" style="margin-bottom:8px;">
      <input id="ghInput" class="input" placeholder="paste geohash e.g. u09tunqu9">
      <button id="goBtn" class="btn">Go</button>
    </div>
    <div class="row" style="gap:10px;align-items:center;">
      <label class="small">Precision</label>
      <select id="precision" class="input" style="max-width:92px;">
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12" selected>12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
      </select>
      <div style="flex:1" class="info" id="currentGH">current geohash: —</div>
    </div>
  </div>  <div id="map"></div>  <div class="footer">Tiles: OpenStreetMap. No external map API keys required.</div>
</div><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><script>
const BASE32 = "0123456789bcdefghjkmnpqrstuvwxyz";
function geohashEncode(lat, lon, precision){
  let latInterval = [-90,90], lonInterval = [-180,180];
  let isEven = true, bit = 0, ch = 0, geohash = '';
  const bits = [16,8,4,2,1];
  while(geohash.length < precision){
    if(isEven){
      const mid = (lonInterval[0]+lonInterval[1])/2;
      if(lon > mid){ ch |= bits[bit]; lonInterval[0] = mid; } else { lonInterval[1] = mid; }
    } else {
      const mid = (latInterval[0]+latInterval[1])/2;
      if(lat > mid){ ch |= bits[bit]; latInterval[0] = mid; } else { latInterval[1] = mid; }
    }
    isEven = !isEven;
    if(bit < 4) bit++; else { geohash += BASE32[ch]; bit = 0; ch = 0; }
  }
  return geohash;
}

function geohashDecode(gh){
  let isEven = true;
  let latInterval = [-90,90], lonInterval = [-180,180];
  for(let i=0;i<gh.length;i++){
    const c = BASE32.indexOf(gh[i]);
    for(const mask of [16,8,4,2,1]){
      if(isEven){
        if(c & mask) lonInterval[0] = (lonInterval[0]+lonInterval[1])/2; else lonInterval[1] = (lonInterval[0]+lonInterval[1])/2;
      } else {
        if(c & mask) latInterval[0] = (latInterval[0]+latInterval[1])/2; else latInterval[1] = (latInterval[0]+latInterval[1])/2;
      }
      isEven = !isEven;
    }
  }
  const lat = (latInterval[0]+latInterval[1])/2;
  const lon = (lonInterval[0]+lonInterval[1])/2;
  return {lat, lon, latMin: latInterval[0], latMax: latInterval[1], lonMin: lonInterval[0], lonMax: lonInterval[1]};
}

const map = L.map('map', {zoomControl:true}).setView([48.85837,2.294481], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19, attribution:'© OpenStreetMap'}).addTo(map);
let marker = L.marker([48.85837,2.294481]).addTo(map);
let ghRect = null;

function updateCurrentGH(lat, lon){
  const p = parseInt(document.getElementById('precision').value,10);
  const gh = geohashEncode(lat, lon, p);
  document.getElementById('currentGH').textContent = 'current geohash: ' + gh;

  const decoded = geohashDecode(gh);
  if(ghRect) map.removeLayer(ghRect);
  ghRect = L.rectangle([[decoded.latMin, decoded.lonMin], [decoded.latMax, decoded.lonMax]], {color:'#6ee7b7', weight:2, fillOpacity:0.1}).addTo(map);
  return gh;
}

map.on('click', e=>{
  const {lat, lng} = e.latlng;
  marker.setLatLng([lat,lng]);
  const gh = updateCurrentGH(lat, lng);
  document.getElementById('ghInput').value = gh;
});

document.getElementById('locBtn').addEventListener('click', ()=>{
  if(!navigator.geolocation) return alert('geolocation not supported');
  navigator.geolocation.getCurrentPosition(pos=>{
    const lat = pos.coords.latitude; const lon = pos.coords.longitude;
    map.setView([lat, lon], 14);
    marker.setLatLng([lat, lon]);
    const gh = updateCurrentGH(lat, lon);
    document.getElementById('ghInput').value = gh;
  }, err=>{ alert('geolocation error: ' + (err.message || err.code)); }, {enableHighAccuracy:true, timeout:8000});
});

document.getElementById('goBtn').addEventListener('click', ()=>{
  const val = document.getElementById('ghInput').value.trim();
  if(!val) return;
  try{
    const dec = geohashDecode(val);
    map.setView([dec.lat, dec.lon], 14);
    marker.setLatLng([dec.lat, dec.lon]);
    if(ghRect) map.removeLayer(ghRect);
    ghRect = L.rectangle([[dec.latMin, dec.lonMin], [dec.latMax, dec.lonMax]], {color:'#6ee7b7', weight:2, fillOpacity:0.1}).addTo(map);
    document.getElementById('currentGH').textContent = 'current geohash: ' + val;
  }catch(e){ alert('invalid geohash'); }
});

document.getElementById('copyBtn').addEventListener('click', ()=>{
  const txt = document.getElementById('currentGH').textContent.replace('current geohash: ','').trim();
  if(!txt) return;
  navigator.clipboard.writeText(txt);
});

document.getElementById('precision').addEventListener('change', ()=>{
  const pos = marker.getLatLng();
  updateCurrentGH(pos.lat, pos.lng);
});

updateCurrentGH(48.85837,2.294481);
</script></body>
</html>